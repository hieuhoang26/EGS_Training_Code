databaseChangeLog:
  - changeSet:
      id: create-ingredients
      author: dev
      changes:
        # cuisines
        - createTable:
            tableName: cuisines
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
#              - column:
#                  name: version
#                  type: BIGINT
#                  defaultValue: 0
#                  constraints:
#                    nullable: false
              - column:
                  name: code
                  type: varchar(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: name
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: updated_at
                  type: timestamp
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false
        # recipes
        - createTable:
            tableName: recipes
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
              - column:
                  name: user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: cuisine_id
                  type: uuid
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: text
              - column:
                  name: servings
                  type: int
              - column:
                  name: prep_time_min
                  type: int
              - column:
                  name: cook_time_min
                  type: int
              - column:
                  name: is_public
                  type: boolean
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: updated_at
                  type: timestamp
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false

        - addForeignKeyConstraint:
            constraintName: fk_recipes_user
            baseTableName: recipes
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id

        - addForeignKeyConstraint:
            constraintName: fk_recipes_cuisine
            baseTableName: recipes
            baseColumnNames: cuisine_id
            referencedTableName: cuisines
            referencedColumnNames: id

        # recipe_steps
        - createTable:
            tableName: recipe_steps
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
              - column:
                  name: recipe_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: step_order
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: instruction
                  type: text
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: updated_at
                  type: timestamp
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false

        - addUniqueConstraint:
            tableName: recipe_steps
            columnNames: recipe_id, step_order

        - addForeignKeyConstraint:
            constraintName: fk_recipes_steps
            baseTableName: recipe_steps
            baseColumnNames: recipe_id
            referencedTableName: recipes
            referencedColumnNames: id

        # recipe_images
        - createTable:
            tableName: recipe_images
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
              - column:
                  name: recipe_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: image_url
                  type: text
              - column:
                  name: is_primary
                  type: boolean
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: updated_at
                  type: timestamp
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false

        - addForeignKeyConstraint:
            constraintName: fk_recipes_images
            baseTableName: recipe_images
            baseColumnNames: recipe_id
            referencedTableName: recipes
            referencedColumnNames: id

        # ingredients
        - createTable:
            tableName: ingredients
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
              - column:
                  name: canonical_name
                  type: varchar(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: updated_at
                  type: timestamp
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false



        #  recipe_ingredients
        - createTable:
            tableName: recipe_ingredients
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
              - column:
                  name: recipe_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: ingredient_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: quantity
                  type: decimal(10,2)
              - column:
                  name: unit
                  type: varchar(50)
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: updated_at
                  type: timestamp
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false

        - addUniqueConstraint:
            tableName: recipe_ingredients
            columnNames: recipe_id, ingredient_id, unit

        - addForeignKeyConstraint:
            constraintName: fk_recipe_ingredients1
            baseTableName: recipe_ingredients
            baseColumnNames: recipe_id
            referencedTableName: recipes
            referencedColumnNames: id

        - addForeignKeyConstraint:
            constraintName: fk_recipe_ingredients2
            baseTableName: recipe_ingredients
            baseColumnNames: ingredient_id
            referencedTableName: ingredients
            referencedColumnNames: id

  - changeSet:
      id: sample-data
      author: dev
      context: dev
      changes:
        - insert:
            tableName: permissions
            columns:
              - column: { name: id, valueComputed: gen_random_uuid() }
              - column: { name: name, value: RECIPE:READ }
              - column: { name: description, value: Read recipe }


        - insert:
            tableName: permissions
            columns:
              - column: { name: id, valueComputed: gen_random_uuid() }
              - column: { name: name, value: RECIPE:CREATE }
              - column: { name: description, value: Create recipe }

        - insert:
            tableName: permissions
            columns:
              - column: { name: id, valueComputed: gen_random_uuid() }
              - column: { name: name, value: RECIPE:UPDATE }
              - column: { name: description, value: Update recipe }


        - insert:
            tableName: permissions
            columns:
              - column: { name: id, valueComputed: gen_random_uuid() }
              - column: { name: name, value: RECIPE:DELETE }
              - column: { name: description, value: Delete recipe }

        - insert:
            tableName: roles
            columns:
              - column: { name: id, value: 11111111-1111-1111-1111-111111111111 }
              - column: { name: name, value: ROLE_USER }
              - column: { name: description, value: Normal user }


        - insert:
            tableName: roles
            columns:
              - column: { name: id, value: 22222222-2222-2222-2222-222222222222 }
              - column: { name: name, value: ROLE_ADMIN }
              - column: { name: description, value: Administrator }

        - insert:
            tableName: users
            columns:
              - column: { name: id, value: aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa }
              - column: { name: first_name, value: Admin }
              - column: { name: last_name, value: User }
              - column: { name: email, value: admin@recipe.app }
              - column: { name: password, value: "$2a$10$FJdiOHI0CnDZI/bnwRsq6OxP001NTDG4Rkv.noanWiUk7baqFf68i" }
              - column: { name: status, value: ACTIVE }


        - insert:
            tableName: users
            columns:
              - column: { name: id, value: bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb }
              - column: { name: first_name, value: Normal }
              - column: { name: last_name, value: User }
              - column: { name: email, value: user@recipe.app }
              - column: { name: password, value: "$2a$10$FJdiOHI0CnDZI/bnwRsq6OxP001NTDG4Rkv.noanWiUk7baqFf68i" }
              - column: { name: status, value: ACTIVE }

        - insert:
            tableName: users_roles
            columns:
              - column: { name: user_id, value: aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa }
              - column: { name: role_id, value: 22222222-2222-2222-2222-222222222222 }


        - insert:
            tableName: users_roles
            columns:
              - column: { name: user_id, value: bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb }
              - column: { name: role_id, value: 11111111-1111-1111-1111-111111111111 }

        # ================= CUISINES =================
        - insert:
            tableName: cuisines
            columns:
              - column: { name: id, value: "22222222-2222-2222-2222-222222222222" }
              - column: { name: code, value: "VN" }
              - column: { name: name, value: "Vietnamese" }

        - insert:
            tableName: cuisines
            columns:
              - column: { name: id, value: "22222222-2222-2222-2222-222222222223" }
              - column: { name: code, value: "IT" }
              - column: { name: name, value: "Italian" }

        # ================= INGREDIENTS =================
        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333301" }
              - column: { name: canonical_name, value: "salt" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333302" }
              - column: { name: canonical_name, value: "pepper" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333303" }
              - column: { name: canonical_name, value: "garlic" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333304" }
              - column: { name: canonical_name, value: "onion" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333305" }
              - column: { name: canonical_name, value: "ginger" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333306" }
              - column: { name: canonical_name, value: "beef" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333307" }
              - column: { name: canonical_name, value: "rice noodles" }

        - insert:
            tableName: ingredients
            columns:
              - column: { name: id, value: "33333333-3333-3333-3333-333333333308" }
              - column: { name: canonical_name, value: "fish sauce" }

        # ================= RECIPES =================
        - insert:
            tableName: recipes
            columns:
              - column: { name: id, value: "44444444-4444-4444-4444-444444444444" }
              - column: { name: user_id, value: "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa" }
              - column: { name: cuisine_id, value: "22222222-2222-2222-2222-222222222222" }
              - column: { name: name, value: "Pho Bo" }
              - column: { name: servings, valueNumeric: 2 }
              - column: { name: prep_time_min, valueNumeric: 20 }
              - column: { name: cook_time_min, valueNumeric: 120 }
              - column: { name: is_public, valueBoolean: true }

        # ================= RECIPE INGREDIENTS =================
        - insert:
            tableName: recipe_ingredients
            columns:
              - column: { name: id, value: "55555555-5555-5555-5555-555555555501" }
              - column: { name: recipe_id, value: "44444444-4444-4444-4444-444444444444" }
              - column: { name: ingredient_id, value: "33333333-3333-3333-3333-333333333306" }
              - column: { name: quantity, valueNumeric: 300 }
              - column: { name: unit, value: "gram" }

        - insert:
            tableName: recipe_ingredients
            columns:
              - column: { name: id, value: "55555555-5555-5555-5555-555555555502" }
              - column: { name: recipe_id, value: "44444444-4444-4444-4444-444444444444" }
              - column: { name: ingredient_id, value: "33333333-3333-3333-3333-333333333307" }
              - column: { name: quantity, valueNumeric: 200 }
              - column: { name: unit, value: "gram" }

        # ================= RECIPE STEPS =================
        - insert:
            tableName: recipe_steps
            columns:
              - column: { name: id, value: "66666666-6666-6666-6666-666666666601" }
              - column: { name: recipe_id, value: "44444444-4444-4444-4444-444444444444" }
              - column: { name: step_order, valueNumeric: 1 }
              - column: { name: instruction, value: "Prepare ingredients and bones" }

        - insert:
            tableName: recipe_steps
            columns:
              - column: { name: id, value: "66666666-6666-6666-6666-666666666602" }
              - column: { name: recipe_id, value: "44444444-4444-4444-4444-444444444444" }
              - column: { name: step_order, valueNumeric: 2 }
              - column: { name: instruction, value: "Simmer broth for 2 hours" }

        # ================= RECIPE IMAGES =================
        - insert:
            tableName: recipe_images
            columns:
              - column: { name: id, value: "77777777-7777-7777-7777-777777777701" }
              - column: { name: recipe_id, value: "44444444-4444-4444-4444-444444444444" }
              - column: { name: image_url, value: "https://cdn.demo/pho.jpg" }
              - column: { name: is_primary, valueBoolean: true }
